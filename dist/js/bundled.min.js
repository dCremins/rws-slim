var scene,camera,controls,renderer,ambient,lightSource,objectPlane,THREE,flaggers=[],signs=[[],[],[],[],[],[],[]],container=document.getElementById("container"),raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,selected=null,hovered=null,glow=new THREE.MeshLambertMaterial({color:12029393,emissive:3355443}),red=new THREE.MeshLambertMaterial({color:16283254}),green=new THREE.MeshLambertMaterial({color:7915401}),blue=new THREE.MeshLambertMaterial({color:2275554}),orange=new THREE.MeshLambertMaterial({color:16167729}),
yellow=new THREE.MeshLambertMaterial({color:16636748}),purple=new THREE.MeshLambertMaterial({color:12029393}),white=new THREE.MeshLambertMaterial({color:16777215}),gray=new THREE.MeshLambertMaterial({color:5592405}),palegray=new THREE.MeshLambertMaterial({color:8881006}),shadows=new THREE.ShadowMaterial({opacity:.3}),windowColor=new THREE.MeshLambertMaterial({color:13688291,transparent:!0,opacity:.5}),clickBoxMaterial=new THREE.MeshLambertMaterial({color:13688291,transparent:!0,opacity:0}),truckMaterial=
new THREE.MeshLambertMaterial({color:15697223}),skinTone1=new THREE.MeshLambertMaterial({color:9262372}),skinTone2=new THREE.MeshLambertMaterial({color:13010498}),skinTone3=new THREE.MeshLambertMaterial({color:15843965}),skinTone4=new THREE.MeshLambertMaterial({color:16767916}),workerSign=(new THREE.TextureLoader).load("images/sign-01.png"),workerSignMaterial=new THREE.MeshBasicMaterial({map:workerSign}),flaggerSign=(new THREE.TextureLoader).load("images/sign-02.png"),flaggerSignMaterial=new THREE.MeshBasicMaterial({map:flaggerSign}),
leftSign=(new THREE.TextureLoader).load("images/sign-03.png"),leftSignMaterial=new THREE.MeshBasicMaterial({map:leftSign}),rightSign=(new THREE.TextureLoader).load("images/sign-04.png"),rightSignMaterial=new THREE.MeshBasicMaterial({map:rightSign}),prepareStopSign=(new THREE.TextureLoader).load("images/sign-05.png"),prepareStopSignMaterial=new THREE.MeshBasicMaterial({map:prepareStopSign}),oneLaneSign=(new THREE.TextureLoader).load("images/sign-06.png"),oneLaneSignMaterial=new THREE.MeshBasicMaterial({map:oneLaneSign}),
machineAheadSign=(new THREE.TextureLoader).load("images/sign-07.png"),machineAheadSignMaterial=new THREE.MeshBasicMaterial({map:machineAheadSign}),workAheadSign=(new THREE.TextureLoader).load("images/sign-08.png"),workAheadSignMaterial=new THREE.MeshBasicMaterial({map:workAheadSign}),constSign=(new THREE.TextureLoader).load("images/sign-09.png"),constSignMaterial=new THREE.MeshBasicMaterial({map:constSign}),utilitySign=(new THREE.TextureLoader).load("images/sign-10.png"),utilitySignMaterial=new THREE.MeshBasicMaterial({map:utilitySign}),
rLaneSign=(new THREE.TextureLoader).load("images/sign-11.png"),rLaneSignMaterial=new THREE.MeshBasicMaterial({map:rLaneSign}),menWorkSign=(new THREE.TextureLoader).load("images/sign-12.png"),menWorkSignMaterial=new THREE.MeshBasicMaterial({map:menWorkSign}),lLaneSign=(new THREE.TextureLoader).load("images/sign-13.png"),lLaneMaterial=new THREE.MeshBasicMaterial({map:lLaneSign}),fMenSign=(new THREE.TextureLoader).load("images/sign-14.png"),fMenSignMaterial=new THREE.MeshBasicMaterial({map:fMenSign}),
flagAheadSign=(new THREE.TextureLoader).load("images/sign-15.png"),flagAheadSignMaterial=new THREE.MeshBasicMaterial({map:flagAheadSign}),closedSign=(new THREE.TextureLoader).load("images/sign-16.png"),closedSignMaterial=new THREE.MeshBasicMaterial({map:closedSign}),endWorkSign=(new THREE.TextureLoader).load("images/sign-17.png"),endSignMaterial=new THREE.MeshBasicMaterial({map:endWorkSign}),coneGeometry=new THREE.CylinderGeometry(.07,.2,.5,32,.8,!1,.8),coneBottomG=new THREE.BoxGeometry(.5,.06,.5);
coneBottomG.translate(0,-.23,0);coneGeometry.merge(coneBottomG);coneGeometry.scale(1.5,1.5,1.5);coneGeometry.translate(0,.125,0);var stripeGeometry=new THREE.CylinderGeometry(.116,.155,.15,32,1,!1,.8);stripeGeometry.scale(1.5,1.5,1.5);stripeGeometry.translate(0,.125,0);var showing="none";
function slide(a){"none"!==showing&&(document.getElementById(showing).style.top="-535px");"none"!==showing&&document.getElementById("button-"+showing).classList.remove("selected");showing===a?showing="none":(document.getElementById("button-"+a).classList.add("selected"),document.getElementById(a).style.top="100px",showing=a)}function init(){scene=new THREE.Scene;window.scene=scene;window.THREE=THREE;initRoad();initBackHoe();initTruck();initWorkers();initCamera();initLights();initRender()}
function initCamera(){camera=new THREE.PerspectiveCamera(60,window.innerWidth/(window.innerHeight-100),1,100);camera.position.set(0,45,25)}
function initLights(){ambient=new THREE.HemisphereLight(14610162,6708333,.9);lightSource=new THREE.SpotLight(16571508,.2);lightSource.position.set(-50,40,-5);lightSource.castShadow=!0;lightSource.shadow.camera.left=-10;lightSource.shadow.camera.right=10;lightSource.shadow.camera.top=10;lightSource.shadow.camera.bottom=-10;lightSource.shadow.camera.near=.1;lightSource.shadow.camera.far=1E3;lightSource.shadow.mapSize.width=2048;lightSource.shadow.mapSize.height=2048;scene.add(ambient);scene.add(lightSource)}
function initRender(){renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(window.innerWidth,window.innerHeight-100);renderer.setClearColor(13498879,1);renderer.setPixelRatio(window.devicePixelRatio);renderer.shadowMap.enabled=!0;renderer.shadowMap.type=THREE.PCFSoftShadowMap;container.appendChild(renderer.domElement);controls=new THREE.OrbitControls(camera,renderer.domElement);controls.addEventListener("change",render);container.addEventListener("mousemove",onDocumentMouseMove,!1);container.addEventListener("mouseup",
onDocumentMouseCancel,!1);container.addEventListener("mousedown",onDocumentMouseDown,!1);container.addEventListener("touchmove",onDocumentTouchMove,!1);container.addEventListener("touchstart",onDocumentTouchStart,!1);container.addEventListener("touchend",onDocumentTouchEnd,!1)}
function initBackHoe(){var a=new THREE.Geometry,f=new THREE.Geometry,b=new THREE.Geometry,c=new THREE.BoxGeometry(4,.5,1.2);c.translate(.75,.25,-.5);a.merge(c);c=new THREE.BoxGeometry(.5,.5,1.2);c.translate(-1,1,-.5);c.vertices[4].y-=.5;c.vertices[5].y-=.5;a.merge(c);c=new THREE.BoxGeometry(.25,.5,1.2);c.translate(-.63,1,-.5);a.merge(c);c=new THREE.BoxGeometry(2.5,.25,1.2);c.translate(0,.625,-.5);a.merge(c);c=new THREE.BoxGeometry(1.9,.1,1.3);c.translate(.4,2.3,-.5);a.merge(c);c=new THREE.BoxGeometry(.75,
.5,.25);c.translate(2.55,.25,.25);c.vertices[4].x-=.5;c.vertices[5].x-=.5;c.vertices[0].y+=.55;c.vertices[1].y+=.55;c.vertices[0].x-=.4;c.vertices[1].x-=.4;c.vertices[2].y+=1;c.vertices[3].y+=1;c.vertices[6].y+=.5;c.vertices[7].y+=.5;c.vertices[6].x+=.2;c.vertices[7].x+=.2;a.merge(c);c.translate(0,0,-1.5);a.merge(c);c=new THREE.BoxGeometry(1,.25,.3);c.translate(3.025,1.18,.25);c.vertices[4].x+=.35;c.vertices[5].x+=.35;c.vertices[0].y-=.3;c.vertices[1].y-=.3;c.vertices[2].y-=.5;c.vertices[3].y-=.5;
a.merge(c);c.translate(0,0,-1.5);a.merge(c);c=new THREE.BoxGeometry(.75,.45,.3);c.translate(3.9,.78,.25);c.vertices[0].y-=.5;c.vertices[1].y-=.5;c.vertices[0].x+=.2;c.vertices[1].x+=.2;c.vertices[2].y-=.5;c.vertices[3].y-=.5;a.merge(c);c.translate(0,0,-1.5);a.merge(c);c=new THREE.TorusGeometry(.34,.1,4,50,6.3);c.translate(-.25,-.213,.415);a.merge(c);c.translate(0,0,-1.825);a.merge(c);c.translate(3.2,0,0);a.merge(c);c.translate(0,0,1.825);a.merge(c);c=new THREE.CylinderGeometry(.5,.5,.3,32);c.translate(-.25,
.2,.25);c.rotateX(1.6);a.merge(c);c.translate(0,0,-1.3);a.merge(c);c.translate(3.25,0,0);a.merge(c);c.translate(0,0,1.3);a.merge(c);c=new THREE.Mesh(a,truckMaterial);b.merge(a);a=new THREE.BoxGeometry(2.75,1.75,1.125);a.translate(.94,1.375,-.5);a.vertices[0].x-=1.1;a.vertices[1].x-=1.1;a.vertices[3].y+=.15;a.vertices[2].y+=.15;var d=new THREE.Mesh(a,windowColor);c.add(d);b.merge(a);a=new THREE.BoxGeometry(.1,1.5,.1);a.translate(-.45,1.5,.05);f.merge(a);a.translate(.55,0,0);f.merge(a);a.translate(0,
0,-1.1);f.merge(a);a.translate(-.55,0,0);f.merge(a);a=new THREE.BoxGeometry(.05,1.5,.1);a.translate(1.23,1.5,.05);f.merge(a);a.translate(0,0,-1.1);f.merge(a);a=new THREE.BoxGeometry(.05,1.75,.1);a.translate(1.28,1.375,.05);a.vertices[0].y-=.05;a.vertices[1].y-=.05;f.merge(a);a.translate(0,0,-1.1);f.merge(a);a=new THREE.BoxGeometry(.1,.25,.1);a.translate(2.3,.625,.05);a.vertices[0].y-=.05;a.vertices[1].y-=.05;f.merge(a);a.translate(0,0,-1.1);f.merge(a);a=new THREE.BoxGeometry(1.75,.1,.1);a.translate(.375,
2.2,.05);f.merge(a);a.translate(0,0,-1.1);f.merge(a);a=new THREE.BoxGeometry(1,.1,.1);a.translate(1.75,.55,.05);f.merge(a);a.translate(0,0,-1.1);f.merge(a);a=new THREE.BoxGeometry(1.75,.5,.1);a.translate(.4,1,.05);f.merge(a);a.translate(0,0,-1.1);f.merge(a);a=new THREE.BoxGeometry(.01,.2,1);a.translate(-.496,1.3,-.5);f.merge(a);a.translate(0,.9,0);f.merge(a);a=new THREE.BoxGeometry(1.045,.1,.1);a.translate(1.825,2.155,.05);a.vertices[0].y-=1.5;a.vertices[1].y-=1.5;a.vertices[2].y-=1.5;a.vertices[3].y-=
1.5;f.merge(a);a.translate(0,0,-1.1);f.merge(a);a=new THREE.BoxGeometry(.1,.1,1);a.translate(2.3,.55,-.5);f.merge(a);a=new THREE.BoxGeometry(.4,.1,.4);a.translate(.7,.75,-.5);f.merge(a);a=new THREE.BoxGeometry(.1,.7,.4);a.translate(.45,1.05,-.5);f.merge(a);a=new THREE.CylinderGeometry(.2,.2,.05,32);a.translate(1.5,-.75,-.5);a.rotateZ(1.2);f.merge(a);a=new THREE.BoxGeometry(.95,.24,.98);a.translate(1.75,.65,-.5);f.merge(a);a=new THREE.BoxGeometry(.95,.5,.98);a.translate(1.75,1,-.5);a.vertices[0].x-=
.4;a.vertices[1].x-=.4;f.merge(a);a=new THREE.Shape;a.moveTo(0,.75);a.bezierCurveTo(0,1.75,1.5,1.75,1.5,.75);a.lineTo(1.125,.75001);a.bezierCurveTo(1.125,1.25,.375,1.25,.375,.75);a.bezierCurveTo(.375,.35,1.125,.35,1.125,.75);a.lineTo(1.5,.75001);a.bezierCurveTo(1.5,-.125,0,-.125,0,.75);a=new THREE.ExtrudeGeometry(a,{amount:.5,steps:50,bevelEnabled:!1,curveSegments:8});a.translate(-1,-1,0);f.merge(a);a.translate(0,0,-1.5);f.merge(a);a.translate(3.2,0,0);f.merge(a);a.translate(0,0,1.5);f.merge(a);a=
new THREE.CylinderGeometry(.15,.15,.3,6);a.rotateX(1.6);a.translate(-.25,-.2,.3);f.merge(a);a.translate(0,0,-1.5);f.merge(a);a.translate(3.2,0,0);f.merge(a);a.translate(0,0,1.5);f.merge(a);a=new THREE.BoxGeometry(.2,.2,1.5);a.translate(-1.25,0,-.5);f.merge(a);a=new THREE.BoxGeometry(.32,.2,1.5);a.translate(-1.19,-.2,-.5);f.merge(a);a=new THREE.BoxGeometry(1.25,.2,1.5);a.translate(1.25,-.2,-.5);f.merge(a);a=new THREE.BoxGeometry(.2,.2,.9);a.translate(2.75,-.2,-.45);f.merge(a);a=new THREE.BoxGeometry(.05,
.2,.5);a.translate(-1.25,.3,-.5);f.merge(a);a=new THREE.BoxGeometry(.5,.2,2);a.rotateZ(.2);a.translate(4.825,.7,-.5);f.merge(a);a=new THREE.BoxGeometry(1,.2,2);a.rotateZ(1.15);a.translate(4.45,.25,-.5);f.merge(a);a=new THREE.BoxGeometry(1,.2,2);a.rotateZ(-.7);a.translate(4.61,-.42,-.5);f.merge(a);a=new THREE.BoxGeometry(.75,.2,2);a.translate(5.3,-.717,-.5);f.merge(a);a=new THREE.BoxGeometry(.5,.25,.2);a.translate(4.839,.53,.4);a.vertices[6].y+=.2;a.vertices[7].y+=.2;a.vertices[2].y+=.1;a.vertices[3].y+=
.1;a.vertices[2].x-=.15;a.vertices[3].x-=.15;f.merge(a);a.translate(0,0,-1.8);f.merge(a);a=new THREE.BoxGeometry(.75,.25,.2);a.translate(5.3,-.5,.4);a.vertices[4].x+=.2;a.vertices[5].x+=.2;a.vertices[0].y-=.2;a.vertices[1].y-=.2;f.merge(a);a.translate(0,0,-1.8);f.merge(a);a=new THREE.BoxGeometry(.75,.75,.2);a.translate(4.75,.25,.4);a.vertices[2].x+=.1;a.vertices[3].x+=.1;a.vertices[4].x+=.2;a.vertices[5].x+=.2;a.vertices[0].x-=.23;a.vertices[1].x-=.23;a.vertices[0].y+=.02;a.vertices[1].y+=.02;f.merge(a);
a.translate(0,0,-1.8);f.merge(a);a=new THREE.BoxGeometry(.5,.5,.2);a.translate(4.875,-.375,.4);a.vertices[0].x+=.1;a.vertices[1].x+=.1;a.vertices[2].x+=.3;a.vertices[3].x+=.3;a.vertices[4].x-=.25;a.vertices[5].x-=.25;a.vertices[6].x+=.05;a.vertices[7].x+=.05;a.vertices[6].y+=.05;a.vertices[7].y+=.05;f.merge(a);a.translate(0,0,-1.8);f.merge(a);a=new THREE.Mesh(f,gray);c.add(a);b.merge(f);f=new THREE.Mesh(b,shadows);c.add(f);c.castShadow=!0;c.position.set(2.5,1.4,-15);scene.add(c)}
function flagger(a,f){var b=new THREE.Geometry,c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.Geometry,g=new THREE.Geometry,l=new THREE.Geometry,m=new THREE.BoxGeometry(1.7,2,1);m.rotateY(-.5);m.center();m.translate(.05,0,0);m=new THREE.Mesh(m,clickBoxMaterial);var h=new THREE.BoxGeometry(1,1.4,.8);h.translate(0,.1,0);h.vertices[0].z-=.15;h.vertices[0].x-=.15;h.vertices[1].z+=.15;h.vertices[1].x-=.15;h.vertices[4].z+=.15;h.vertices[4].x+=.15;h.vertices[5].z-=.15;h.vertices[5].x+=.15;h.rotateY(-.5);
h.translate(.45,0,.7);h.scale(.5,.5,.5);e.merge(h);h=new THREE.SphereGeometry(.2,32,32,1,6.3,0,1.5);h.translate(0,.7,0);var k=new THREE.CylinderGeometry(.2,.2,.02,32);k.translate(0,.72,.1);h.merge(k);h.rotateY(-.5);h.translate(.225,0,.345);e.merge(h);h=new THREE.CylinderGeometry(.4,.4,.1,8);h.translate(.75,.25,-.55);h.rotateZ(1.25);h.rotateY(.75);h.rotateX(.5);e.merge(h);e.center();e.translate(0,.2,0);f=new THREE.Mesh(e,f);f.castShadow=!0;l.merge(e);m.add(f);e=new THREE.BoxGeometry(.2,.5,.4);e.translate(-.13,
.17,0);e.vertices[0].z-=.05;e.vertices[1].z+=.05;e.vertices[4].z+=.05;e.vertices[4].x+=.05;e.vertices[5].z-=.05;e.vertices[5].x+=.05;b.merge(e);e=new THREE.BoxGeometry(.2,.5,.4);e.translate(.13,.17,0);e.vertices[5].z-=.05;e.vertices[4].z+=.05;e.vertices[1].z+=.05;e.vertices[1].x-=.05;e.vertices[0].z-=.05;e.vertices[0].x-=.05;b.merge(e);e=new THREE.BoxGeometry(.2,.5,.025);e.translate(0,.17,-.1875);e.vertices[0].z+=.05;e.vertices[1].z+=.05;e.vertices[4].z+=.05;e.vertices[5].z+=.05;b.merge(e);b.rotateY(-.5);
b.center();b.translate(.295,-.12,.165);e=new THREE.Mesh(b,orange);e.castShadow=!0;l.merge(b);m.add(e);b=new THREE.BoxGeometry(.05,.5,.001);b.translate(-.11,.17,.201);b.vertices[0].z-=.05;b.vertices[1].z-=.05;b.vertices[4].z-=.05;b.vertices[5].z-=.05;c.merge(b);b.translate(.22,0,0);c.merge(b);b=new THREE.BoxGeometry(.05,.5,.001);b.translate(-.11,.17,-.201);b.vertices[0].z+=.05;b.vertices[1].z+=.05;b.vertices[4].z+=.05;b.vertices[5].z+=.05;c.merge(b);b.translate(.22,0,0);c.merge(b);b=new THREE.BoxGeometry(.05,
.001,.3);b.translate(-.11,.42,0);c.merge(b);b.translate(.22,0,0);c.merge(b);b=new THREE.BoxGeometry(.2,.2,.001);b.translate(-.13,.02,.201);b.vertices[4].x+=.02;b.vertices[5].x+=.02;b.vertices[0].z-=.02;b.vertices[1].z-=.02;b.vertices[4].z-=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.2,.2,.001);b.translate(.13,.02,.201);b.vertices[0].x-=.02;b.vertices[1].x-=.02;b.vertices[0].z-=.02;b.vertices[1].z-=.02;b.vertices[4].z-=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.001,
.2,.4);b.translate(-.23,.02,0);b.vertices[0].x+=.02;b.vertices[1].x+=.02;b.vertices[4].x+=.02;b.vertices[5].x+=.02;b.vertices[0].z-=.02;b.vertices[1].z+=.02;b.vertices[4].z+=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.001,.2,.4);b.translate(.23,.02,0);b.vertices[0].x-=.02;b.vertices[1].x-=.02;b.vertices[4].x-=.02;b.vertices[5].x-=.02;b.vertices[0].z-=.02;b.vertices[1].z+=.02;b.vertices[4].z+=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.45,.2,.001);b.translate(0,.02,
-.201);b.vertices[0].x-=.02;b.vertices[1].x-=.02;b.vertices[4].x+=.02;b.vertices[5].x+=.02;b.vertices[0].z+=.02;b.vertices[1].z+=.02;b.vertices[4].z+=.02;b.vertices[5].z+=.02;c.merge(b);c.rotateY(-.5);c.center();c.translate(.295,-.12,.165);b=new THREE.Mesh(c,yellow);l.merge(c);m.add(b);c=new THREE.BoxGeometry(.5,.8,.8);c.translate(-.25,-1,0);c.vertices[0].x-=.1;c.vertices[1].x-=.1;c.vertices[2].x-=.3;c.vertices[2].z-=.3;c.vertices[3].x-=.3;c.vertices[3].z+=.3;c.vertices[6].z+=.3;c.vertices[7].z-=
.3;d.merge(c);c=new THREE.BoxGeometry(.5,.8,.8);c.translate(.25,-1,0);c.vertices[4].x+=.1;c.vertices[5].x+=.1;c.vertices[2].z-=.3;c.vertices[3].z+=.3;c.vertices[6].x+=.3;c.vertices[6].z+=.3;c.vertices[7].x+=.3;c.vertices[7].z-=.3;d.merge(c);d.rotateY(-.5);d.scale(.5,.5,.5);d.center();d.translate(.295,-.78,.165);c=new THREE.Mesh(d,blue);e.castShadow=!0;l.merge(d);m.add(c);d=new THREE.BoxGeometry(.5,.4,.5);d.translate(.64,.6,0);d.vertices[0].y-=.1;d.vertices[0].z+=.1;d.vertices[0].x-=.2;d.vertices[1].y-=
.08;d.vertices[1].z+=.3;d.vertices[1].x-=.1;d.vertices[2].z+=.1;d.vertices[2].x-=.05;d.vertices[2].y+=.1;d.vertices[3].y+=.2;d.vertices[3].z+=.4;d.vertices[3].x+=.2;d.vertices[4].x-=.04;d.vertices[5].x-=.04;g.merge(d);d=new THREE.BoxGeometry(.5,.3,.3);d.translate(1.14,.6,.3);d.vertices[0].y+=.25;d.vertices[0].z-=.1;d.vertices[0].x-=.65;d.vertices[1].y+=.25;d.vertices[1].z+=.05;d.vertices[1].x-=.5;d.vertices[2].y+=.55;d.vertices[2].z-=.05;d.vertices[2].x-=.55;d.vertices[3].y+=.55;d.vertices[3].z+=
.1;d.vertices[3].x-=.4;d.vertices[4].x-=.1;d.vertices[4].z-=.1;d.vertices[4].y-=.03;d.vertices[5].y-=.05;d.vertices[5].z-=.1;d.vertices[5].x-=.2;d.vertices[6].x+=.2;d.vertices[6].y+=.15;d.vertices[6].z+=0;d.vertices[7].x-=.05;d.vertices[7].z-=.1;d.vertices[7].y+=.05;g.merge(d);d=new THREE.BoxGeometry(1,.4,.5);d.translate(-.85,.6,0);d.vertices[5].y-=.8;d.vertices[5].z-=.1;d.vertices[4].y-=.8;d.vertices[4].z+=.1;d.vertices[7].y-=.5;d.vertices[7].z-=.1;d.vertices[6].y-=.5;d.vertices[6].z+=.1;d.vertices[3].x-=
.04;d.vertices[2].x-=.04;g.merge(d);d=new THREE.SphereGeometry(.35,32,32);d.translate(0,1.3,0);g.merge(d);g.rotateY(-.5);g.scale(.5,.5,.5);g.center();g.translate(.215,.11,.155);d=new THREE.Mesh(g,[skinTone1,skinTone2,skinTone3,skinTone4][~~(3*Math.random())]);l.merge(g);m.add(d);g=new THREE.CylinderGeometry(.05,.05,2.4,32);g.scale(.5,.5,.5);g.center();g.translate(-.3,-.3,-.15);d=new THREE.Mesh(g,gray);l.merge(g);m.add(d);l=new THREE.Mesh(l,shadows);m.add(l);m.rotation.set(0,-1.4,0);m.position.set(-6,
1.48,-12);m.name=a+"-flagger1";scene.add(m);flaggers.push(m);l=m.clone(!0);l.rotation.set(0,1.8,0);l.position.set(10,1.48,-28);l.name=a+"-flagger2";scene.add(l);flaggers.push(l)}
function initRoad(){var a=new THREE.Geometry,f=new THREE.Geometry,b=new THREE.Geometry,c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.BoxGeometry(155,1,38);e.translate(0,0,-45.5);a.merge(e);e.translate(0,0,51);a.merge(e);e=new THREE.Mesh(a,green);c.merge(a);a=new THREE.BoxGeometry(155,1,13);a.translate(0,0,-20);var g=new THREE.Mesh(a,gray);e.add(g);c.merge(a);a=new THREE.BoxGeometry(1,.1,.2);a.translate(-75,.5,-20);f.merge(a);for(g=75;-73<=g;g-=2)a.translate(2,0,0),f.merge(a);f=new THREE.Mesh(f,
yellow);e.add(f);f=coneGeometry.clone(!0);a=stripeGeometry.clone(!0);f.translate(0,.75,-19);d.merge(f);a.translate(0,.75,-19);b.merge(a);for(g=1.5;12>=g;g+=2)f.translate(2,0,0),d.merge(f),a.translate(2,0,0),b.merge(a);d=new THREE.Mesh(d,truckMaterial);e.add(d);d=new THREE.BoxGeometry(155,.01,.1);d.translate(0,.5,-26);b.merge(d);d.translate(0,0,12);b.merge(d);b=new THREE.Mesh(b,white);e.add(b);c=new THREE.Mesh(c,shadows);c.position.set(0,3E-4,0);c.receiveShadow=!0;scene.add(c);objectPlane=c;e.castShadow=
!0;scene.add(e)}
function initTruck(){var a=new THREE.Geometry,f=new THREE.Geometry,b=new THREE.Geometry,c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.BoxGeometry(1,.8,1.3);e.translate(-.6,0,0);a.merge(e);e=new THREE.BoxGeometry(.1,.8,1.3);e.translate(.52,.25,0);a.merge(e);e=new THREE.BoxGeometry(.1,.7,.3);e.translate(.52,.85,.5);a.merge(e);e.translate(0,0,-1);a.merge(e);e=new THREE.BoxGeometry(.8,.1,1.3);e.translate(.17,1.15,0);e.vertices[6].x-=.05;e.vertices[7].x-=.05;a.merge(e);e=new THREE.BoxGeometry(.1,1,
.1);e.translate(-.6,.52,-.6);e.rotateZ(-.4);a.merge(e);e.translate(0,0,1.2);a.merge(e);e=new THREE.BoxGeometry(3.2,.3,1.3);e.translate(.9,-.31,0);a.merge(e);e=new THREE.BoxGeometry(2.68,.6,.1);e.translate(1.15,.1,.6);a.merge(e);e.translate(0,0,-1.2);a.merge(e);e=new THREE.BoxGeometry(.1,.6,1.3);e.translate(2.45,.1,0);a.merge(e);a.translate(0,1.5,0);e=new THREE.TorusGeometry(.25,.1,3,199);e.translate(-.3,1.09,.63);a.merge(e);e.translate(0,0,-1.3);a.merge(e);e.translate(2,0,1.3);a.merge(e);e.translate(0,
0,-1.3);a.merge(e);e=new THREE.Mesh(a,white);d.merge(a);a=new THREE.BoxGeometry(1,.8,1.29);a.vertices[4].x+=.26;a.vertices[5].x+=.26;a.vertices[6].x-=.035;a.vertices[7].x-=.035;a.vertices[0].y+=2.2;a.vertices[1].y+=2.2;a.vertices[2].y+=2.3;a.vertices[3].y+=2.3;a.vertices[4].y+=2.2;a.vertices[5].y+=2.2;a.vertices[6].y+=2.3;a.vertices[7].y+=2.3;a=new THREE.Mesh(a,windowColor);e.add(a);a=new THREE.BoxGeometry(.4,.1,.4);a.translate(.25,1.6,.3);b.merge(a);a.translate(0,0,-.6);b.merge(a);a=new THREE.BoxGeometry(.1,
.7,.4);a.translate(.45,1.8,.3);b.merge(a);a.translate(0,0,-.6);b.merge(a);a=new THREE.CylinderGeometry(.2,.2,.05,32);a.translate(-1.9,.65,.3);a.rotateZ(-1.2);b.merge(a);a=new THREE.CylinderGeometry(.45,.45,.2,32);a.translate(-.3,.55,-1.1);a.rotateX(1.6);b.merge(a);a.translate(0,0,-1.2);b.merge(a);a.translate(2,0,1.2);b.merge(a);a.translate(0,0,-1.2);b.merge(a);a=new THREE.BoxGeometry(.01,.7,1.2);a.translate(-1.1,1.5,0);b.merge(a);a=new THREE.BoxGeometry(.05,.2,.5);a.translate(2.5,1.25,0);b.merge(a);
a=new THREE.Mesh(b,gray);e.add(a);d.merge(b);b=new THREE.BoxGeometry(.4,.1,1.4);b.translate(-.95,1.05,0);b.vertices[2].x+=.01;b.vertices[3].x+=.01;f.merge(b);b=new THREE.BoxGeometry(1.1,.1,1.4);b.translate(.7,1.05,0);b.vertices[2].x+=.01;b.vertices[3].x+=.01;b.vertices[6].x-=.01;b.vertices[7].x-=.01;f.merge(b);b=new THREE.BoxGeometry(.4,.1,1.4);b.translate(2.35,1.05,0);b.vertices[6].x-=.01;b.vertices[7].x-=.01;f.merge(b);b=new THREE.Mesh(f,palegray);e.add(b);d.merge(f);f=new THREE.BoxGeometry(.1,
.1,.1);f.translate(2.5,1.25,.45);c.merge(f);f.translate(0,0,-.9);c.merge(f);f=new THREE.BoxGeometry(.1,.05,.5);f.translate(.2,2.72,0);c.merge(f);f=new THREE.Mesh(c,orange);e.add(f);d.merge(c);c=new THREE.Mesh(d,shadows);e.add(c);e.rotation.set(0,.5,0);e.scale.set(.9,.9,.9);e.castShadow=!0;e.position.set(-2.5,0,-10);scene.add(e)}
function initWorkers(){var a=new THREE.Geometry,f=new THREE.Geometry,b=new THREE.Geometry,c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.Geometry,g=new THREE.Geometry,l=new THREE.Geometry,m=[skinTone1,skinTone2,skinTone3,skinTone4],h=new THREE.BoxGeometry(1,.4,.5);h.translate(3.55,1.8,6.5);h.vertices[0].y-=.75;h.vertices[1].y-=.75;h.vertices[2].y-=.5;h.vertices[3].y-=.5;h.vertices[0].x-=.5;h.vertices[1].x-=.5;h.vertices[2].x-=.5;h.vertices[3].x-=.5;h.vertices[0].z-=.15;h.vertices[1].z+=.15;
h.vertices[2].z-=.15;h.vertices[3].z+=.15;h.rotateY(-1);a.merge(h);var k=new THREE.BoxGeometry(1,.4,.5);k.translate(1.85,1.8,6.5);k.vertices[5].y+=.3;k.vertices[4].y+=.3;k.vertices[7].y+=.55;k.vertices[6].y+=.55;k.vertices[5].x+=.8;k.vertices[4].x+=.8;k.vertices[7].x+=.8;k.vertices[6].x+=.8;k.vertices[5].z+=.9;k.vertices[4].z+=1.05;k.vertices[7].z+=.9;k.vertices[6].z+=1.05;k.rotateY(-1);a.merge(k);var p=new THREE.SphereGeometry(.35,32,32);p.translate(2.7,2.5,6.5);p.rotateY(-1);a.merge(p);a.scale(.5,
.5,.5);a.translate(4.55,.6,3.5);k=~~(3*Math.random());var n=new THREE.Mesh(a,m[k]);l.merge(a);h.rotateY(1.5);h.translate(-5.4,.1,.35);f.merge(h);p.translate(4.1,0,-1);f.merge(p);k=new THREE.BoxGeometry(1,.4,.5);k.translate(-.85,.6,0);k.vertices[4].y-=.75;k.vertices[5].y-=.75;k.vertices[6].y-=.5;k.vertices[7].y-=.5;k.vertices[0].x+=.05;k.vertices[1].x+=.05;k.vertices[4].x+=.5;k.vertices[5].x+=.5;k.vertices[6].x+=.5;k.vertices[7].x+=.5;k.vertices[4].z+=.15;k.vertices[5].z-=.15;k.vertices[6].z+=.15;
k.vertices[7].z-=.15;k.rotateY(.5);k.translate(.065,1.3,4.79);f.merge(k);f.scale(.5,.5,.5);f.translate(4.52,.55,3.52);k=~~(3*Math.random());a=new THREE.Mesh(f,m[k]);n.add(a);l.merge(f);h=new THREE.BoxGeometry(1,.4,.5);h.translate(.85,1.8,0);h.vertices[0].y-=.45;h.vertices[1].y-=.45;h.vertices[2].y-=.2;h.vertices[3].y-=.2;h.vertices[0].x-=.5;h.vertices[1].x-=.5;h.vertices[2].x-=.5;h.vertices[3].x-=.5;h.vertices[0].z+=.45;h.vertices[1].z+=.85;h.vertices[2].z+=.45;h.vertices[3].z+=.85;h.vertices[4].z+=
.02;h.vertices[6].z-=.04;b.merge(h);k=new THREE.BoxGeometry(1,.4,.5);k.translate(-.85,1.8,0);k.vertices[5].y-=.45;k.vertices[4].y-=.45;k.vertices[7].y-=.2;k.vertices[6].y-=.2;k.vertices[5].x+=.5;k.vertices[4].x+=.5;k.vertices[7].x+=.5;k.vertices[6].x+=.5;k.vertices[5].z+=.45;k.vertices[4].z+=.85;k.vertices[7].z+=.45;k.vertices[6].z+=.85;k.vertices[1].z+=.02;k.vertices[3].z-=.04;b.merge(k);p.translate(-.1,0,-5);b.merge(p);b.scale(.5,.5,.5);b.rotateY(-.35);b.translate(5.95,.6,5.875);k=~~(3*Math.random());
f=new THREE.Mesh(b,m[k]);n.add(f);l.merge(b);b=new THREE.BoxGeometry(1,1.4,.8);b.vertices[0].z-=.15;b.vertices[0].x-=.15;b.vertices[1].z+=.15;b.vertices[1].x-=.15;b.vertices[4].z+=.15;b.vertices[4].x+=.15;b.vertices[5].z-=.15;b.vertices[5].x+=.15;b.scale(.5,.5,.5);b.rotateY(-1);b.translate(2.55,1.25,6.4);g.merge(b);b.rotateY(1.5);b.translate(-2,0,8);g.merge(b);b.rotateY(-.8);b.translate(7,0,-1.5);g.merge(b);b=new THREE.Mesh(g,palegray);n.add(b);l.merge(g);b=new THREE.Geometry;g=new THREE.BoxGeometry(.2,
.5,.4);g.translate(-.13,.17,0);g.vertices[0].z-=.05;g.vertices[1].z+=.05;g.vertices[4].z+=.05;g.vertices[4].x+=.05;g.vertices[5].z-=.05;g.vertices[5].x+=.05;b.merge(g);g=new THREE.BoxGeometry(.2,.5,.4);g.translate(.13,.17,0);g.vertices[5].z-=.05;g.vertices[4].z+=.05;g.vertices[1].z+=.05;g.vertices[1].x-=.05;g.vertices[0].z-=.05;g.vertices[0].x-=.05;b.merge(g);g=new THREE.BoxGeometry(.2,.5,.025);g.translate(0,.17,-.1875);g.vertices[0].z+=.05;g.vertices[1].z+=.05;g.vertices[4].z+=.05;g.vertices[5].z+=
.05;b.merge(g);b.rotateY(-1);b.translate(2.55,1.19,6.4);c.merge(b);b.rotateY(1.5);b.translate(-2,0,8);c.merge(b);b.rotateY(-.8);b.translate(7,0,-1.5);c.merge(b);b=new THREE.SphereGeometry(.2,32,32,1,6.3,0,1.5);b.translate(2.55,1.83,6.39);c.merge(b);b.translate(2,0,-.5);c.merge(b);b.translate(1.425,0,-.125);c.merge(b);b=new THREE.CylinderGeometry(.2,.2,.02,32);b.translate(2.45,1.846,6.45);c.merge(b);b.translate(2.15,0,-.45);c.merge(b);b.translate(1.325,0,-.125);c.merge(b);b=new THREE.Mesh(c,truckMaterial);
n.add(b);l.merge(c);c=new THREE.Geometry;b=new THREE.BoxGeometry(.05,.5,.001);b.translate(-.11,.17,.201);b.vertices[0].z-=.05;b.vertices[1].z-=.05;b.vertices[4].z-=.05;b.vertices[5].z-=.05;c.merge(b);b.translate(.22,0,0);c.merge(b);b=new THREE.BoxGeometry(.05,.5,.001);b.translate(-.11,.17,-.201);b.vertices[0].z+=.05;b.vertices[1].z+=.05;b.vertices[4].z+=.05;b.vertices[5].z+=.05;c.merge(b);b.translate(.22,0,0);c.merge(b);b=new THREE.BoxGeometry(.05,.001,.3);b.translate(-.11,.42,0);c.merge(b);b.translate(.22,
0,0);c.merge(b);b=new THREE.BoxGeometry(.2,.2,.001);b.translate(-.13,.02,.201);b.vertices[4].x+=.02;b.vertices[5].x+=.02;b.vertices[0].z-=.02;b.vertices[1].z-=.02;b.vertices[4].z-=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.2,.2,.001);b.translate(.13,.02,.201);b.vertices[0].x-=.02;b.vertices[1].x-=.02;b.vertices[0].z-=.02;b.vertices[1].z-=.02;b.vertices[4].z-=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.001,.2,.4);b.translate(-.23,.02,0);b.vertices[0].x+=.02;b.vertices[1].x+=
.02;b.vertices[4].x+=.02;b.vertices[5].x+=.02;b.vertices[0].z-=.02;b.vertices[1].z+=.02;b.vertices[4].z+=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.001,.2,.4);b.translate(.23,.02,0);b.vertices[0].x-=.02;b.vertices[1].x-=.02;b.vertices[4].x-=.02;b.vertices[5].x-=.02;b.vertices[0].z-=.02;b.vertices[1].z+=.02;b.vertices[4].z+=.02;b.vertices[5].z-=.02;c.merge(b);b=new THREE.BoxGeometry(.45,.2,.001);b.translate(0,.02,-.201);b.vertices[0].x-=.02;b.vertices[1].x-=.02;b.vertices[4].x+=.02;
b.vertices[5].x+=.02;b.vertices[0].z+=.02;b.vertices[1].z+=.02;b.vertices[4].z+=.02;b.vertices[5].z+=.02;c.merge(b);c.merge(g);c.rotateY(-1);c.translate(2.55,1.19,6.4);d.merge(c);c.rotateY(1.5);c.translate(-2,0,8);d.merge(c);c.rotateY(-.8);c.translate(7,0,-1.5);d.merge(c);c=new THREE.Mesh(d,yellow);n.add(c);l.merge(d);d=new THREE.BoxGeometry(.5,.8,.8);d.vertices[0].x-=.1;d.vertices[1].x-=.1;d.vertices[2].x-=.3;d.vertices[2].z-=.3;d.vertices[3].x-=.3;d.vertices[3].z+=.3;d.vertices[6].z+=.3;d.vertices[7].z-=
.3;d.scale(.5,.5,.5);d.rotateY(-1);d.translate(2.485,.702,6.3);e.merge(d);d.rotateY(1.5);d.translate(-2,0,8);e.merge(d);d.rotateY(-.8);d.translate(7,0,-1.5);e.merge(d);d=new THREE.BoxGeometry(.5,.8,.8);d.vertices[4].x+=.1;d.vertices[5].x+=.1;d.vertices[2].z-=.3;d.vertices[3].z+=.3;d.vertices[6].x+=.3;d.vertices[6].z+=.3;d.vertices[7].x+=.3;d.vertices[7].z-=.3;d.scale(.5,.5,.5);d.rotateY(-1);d.translate(2.615,.702,6.5);e.merge(d);d.rotateY(1.5);d.translate(-2,0,8);e.merge(d);d.rotateY(-.8);d.translate(7,
0,-1.5);e.merge(d);d=new THREE.Mesh(e,blue);n.add(d);l.merge(e);e=new THREE.BoxGeometry(.8,.6,.025);e.rotateX(.3);e.rotateY(-.3);e.translate(5.85,1.3,6.15);d=new THREE.Mesh(e,white);n.add(d);l.merge(e);l=new THREE.Mesh(l,shadows);n.add(l);n.castShadow=!0;n.position.set(-2.35,-.03,-17.55);scene.add(n)}function render(){scene.position.set(0,0,3);renderer.render(scene,camera)}function animate(){render();controls.update()}init();animate();
function focusChange(a){a.parentNode.classList.add("inputFocus");a.parentNode.classList.add("filled")}function focusStop(a){a.parentNode.classList.remove("inputFocus");a.value||a.parentNode.classList.remove("filled")}var arrows=[[],[],[],[],[],[],[]];function arrowArray(a,f){var b=arrows[a].indexOf(f.value);-1!==b&&arrows[a].splice(b,1);f.checked&&arrows[a].unshift(f.value)}
function arrowSign(a,f){if(!(0>=arrows[f].length)){var b=new THREE.Geometry,c=new THREE.Geometry,d=new THREE.BoxGeometry(3.5,4,1);d.rotateY(-1.2);d.center();d=new THREE.Mesh(d,clickBoxMaterial);var e=d.clone(),g=new THREE.CylinderGeometry(.05,.05,.5,32);g.translate(-1.1,2.95,-16.1);c.merge(g);g.translate(0,-.5,0);c.merge(g);g.translate(0,-.5,0);c.merge(g);g.translate(0,-.47,0);c.merge(g);g.translate(-.2,0,0);c.merge(g);g.translate(0,-.5,0);c.merge(g);g.translate(2.501,0,0);c.merge(g);g.translate(0,
.5,0);c.merge(g);g.translate(-.2,0,0);c.merge(g);g.translate(0,.47,0);c.merge(g);g.translate(0,.5,0);c.merge(g);g.translate(0,.5,0);c.merge(g);g=new THREE.CylinderGeometry(.05,.05,2.601,32);g.rotateZ(1.58);g.translate(-.05,1.75,-16.1);c.merge(g);g.translate(0,-.5,0);c.merge(g);g.translate(0,-.5,0);c.merge(g);g=new THREE.CylinderGeometry(.3,.3,.3,32,1,!1,0,3.1);g.rotateZ(1.58);g.translate(1.4,.75,-16.1);c.merge(g);g.translate(-2.9,0,0);c.merge(g);g=new THREE.CylinderGeometry(.01,.1,.2,32);g.rotateX(1.55);
g.translate(-.4,3.7,-16.1);c.merge(g);g.translate(-.35,-.35,0);c.merge(g);g.translate(-.35,-.35,0);c.merge(g);g.translate(.7,0,0);c.merge(g);g.translate(.35,0,0);c.merge(g);g.translate(.35,0,0);c.merge(g);g.translate(.35,0,0);c.merge(g);g.translate(.35,0,0);c.merge(g);g.translate(-1.75,-.35,0);c.merge(g);g.translate(.35,-.35,0);c.merge(g);c.translate(0,0,.15);c.rotateY(-1.2);c.center();a=new THREE.Mesh(c,a);a.castShadow=!0;d.add(a);a=a.clone();a.translateOnAxis((new THREE.Vector3(1,0,-1)).normalize(),
.09);e.add(a);a=new THREE.BoxGeometry(3,2.2,.2);a.translate(0,3,-16);b.merge(a);a=new THREE.CylinderGeometry(.26,.26,.26,32);a.rotateZ(1.58);a.translate(1.4,.74,-16);b.merge(a);a.translate(-2.9,0,0);b.merge(a);b.rotateY(-1.2);b.center();b.translate(.025,0,-.025);b=new THREE.Mesh(b,gray);b.castShadow=!0;d.add(b);b=b.clone();e.add(b);d.name=f+"-arrow1";d.position.set(-1,2.3,-16);scene.add(d);flaggers.push(d);e.name=f+"-arrow2";e.rotation.set(0,-.8,0);e.position.set(10,2.3,-16);scene.add(e);flaggers.push(e)}}
var end=[[],[],[],[],[],[],[]];function endArray(a,f){var b=end[a].indexOf(f.value);-1!==b&&end[a].splice(b,1);f.checked&&end[a].unshift(f.value)}
function endSign(a,f){if(!(0>=end[f].length)){var b=new THREE.BoxGeometry(2.8,2.25,.1);b.rotateX(-1.6);var c=new THREE.BoxGeometry(3.2,3.2,.1);c.rotateX(-1.6);var d=25;0!==Math.abs(f%2)&&(d-=3);var e=4*f;b.translate(d,.5,-9.75+e);b=new THREE.Mesh(b,endSignMaterial);c.translate(d,.48,-10+e);a=new THREE.Mesh(c,a);b.add(a);b.name="signGroup-"+f;b.castShadow=!0;scene.add(b)}}var canv=renderer.domElement,rect=canv.getBoundingClientRect(),yHolder,currentHex=[],movingOn=!1;
function onDocumentMouseDown(a){a.preventDefault();if(hovered){var f=hovered.children,b=hovered.children[0].material;controls.enabled=!1;if(movingOn){b=(a.clientY-rect.top)/canv.clientHeight;mouse.x=(a.clientX-rect.left)/canv.clientWidth*2;mouse.y=-(2*b);raycaster.setFromCamera(mouse,camera);a=raycaster.intersectObject(objectPlane);0<a.length&&hovered.position.set(a[0].point.x,yHolder,a[0].point.z-3);var c=0;f.forEach(function(a){a.material=currentHex[c];c++});currentHex=[];movingOn=!1;container.addEventListener("mousemove",
onDocumentMouseMove,!1)}else container.removeEventListener("mousemove",onDocumentMouseMove,!1),movingOn=!0,yHolder=hovered.position.y,f.forEach(function(a){currentHex.push(a.material)}),glow.color.setHex(b.color.getHex()),f.forEach(function(a){a.material=glow}),hovered.position.set(hovered.position.x,hovered.position.y+1,hovered.position.z);render()}}
function onDocumentTouchStart(a){a.preventDefault();a=a.changedTouches[0];var f=(a.clientY-rect.top)/canv.clientHeight;mouse.x=(a.clientX-rect.left)/canv.clientWidth*2;mouse.y=-(2*f);raycaster.setFromCamera(mouse,camera);f=raycaster.intersectObjects(flaggers);a=raycaster.intersectObject(objectPlane);0<f.length&&(controls.enabled=!1,hovered!==f[0].object&&(hovered=f[0].object));if(hovered){f=hovered.children;var b=hovered.children[0].material;if(movingOn){0<a.length&&hovered.position.set(a[0].point.x,
yHolder,a[0].point.z-3);var c=0;f.forEach(function(a){a.material=currentHex[c];c++});currentHex=[];movingOn=!1;container.addEventListener("touchmove",onDocumentTouchMove,!1)}else container.removeEventListener("touchmove",onDocumentTouchMove,!1),movingOn=!0,yHolder=hovered.position.y,f.forEach(function(a){currentHex.push(a.material)}),glow.color.setHex(b.color.getHex()),f.forEach(function(a){a.material=glow}),hovered.position.set(hovered.position.x,hovered.position.y+1,hovered.position.z);render()}}
function onDocumentMouseMove(a){a.preventDefault();var f=(a.clientY-rect.top)/canv.clientHeight;mouse.x=(a.clientX-rect.left)/canv.clientWidth*2;mouse.y=-(2*f);raycaster.setFromCamera(mouse,camera);a=raycaster.intersectObjects(flaggers);0<a.length?(hovered!==a[0].object&&(hovered=a[0].object),canv.style.cursor="pointer"):(hovered=null,canv.style.cursor="auto")}
function onDocumentTouchMove(a){a.preventDefault();a=a.changedTouches[0];var f=(a.clientY-rect.top)/canv.clientHeight;mouse.x=(a.clientX-rect.left)/canv.clientWidth*2;mouse.y=-(2*f);raycaster.setFromCamera(mouse,camera);a=raycaster.intersectObject(objectPlane);selected&&0<a.length&&(selected.position.set(a[0].point.x,selected.position.y,a[0].point.z),render())}function onDocumentMouseCancel(a){a.preventDefault();movingOn||(controls.enabled=!0,hovered=null,canv.style.cursor="auto")}
function onDocumentTouchEnd(a){a.preventDefault();movingOn||(controls.enabled=!0,hovered=null,canv.style.cursor="auto")}
var clearCones=function(a,f){scene.getObjectByName(a+"-cones")&&scene.remove(scene.getObjectByName(a+"-cones"));scene.getObjectByName("signGroup-"+a)&&scene.remove(scene.getObjectByName("signGroup-"+a));scene.getObjectByName(a+"-flagger1")&&scene.remove(scene.getObjectByName(a+"-flagger1"));scene.getObjectByName(a+"-flagger2")&&scene.remove(scene.getObjectByName(a+"-flagger2"));scene.getObjectByName(a+"-arrow1")&&scene.remove(scene.getObjectByName(a+"-arrow1"));scene.getObjectByName(a+"-arrow2")&&
scene.remove(scene.getObjectByName(a+"-arrow2"));scene.getObjectByName("spacing-"+a)&&scene.remove(scene.getObjectByName("spacing-"+a));scene.getObjectByName("signGroup-"+a)&&scene.remove(scene.getObjectByName("signGroup-"+a));if(f){f=document.getElementsByName("input-"+a);for(var b=0;b<f.length;b++)"checkbox"===f[b].type&&(f[b].checked=!1),"text"===f[b].type&&(f[b].value="");signs[a]=[];arrows[a]=[];end[a]=[];slide("group-"+a)}f=[];for(b=0;b<flaggers.length;b++)flaggers[b].name!==a+"-flagger1"&&
flaggers[b].name!==a+"-flagger2"&&flaggers[b].name!==a+"-arrow1"&&flaggers[b].name!==a+"-arrow2"&&f.push(flaggers[b]);flaggers=f;render()},renderCones=function(a,f){clearCones(a,!1);var b=new THREE.Geometry,c=coneGeometry.clone(!0),d=stripeGeometry.clone(!0),e=new THREE.Geometry,g=new THREE.Geometry;switch(a){case 1:var l=-1;break;case 2:l=-1.5;break;case 3:l=-2;break;case 4:l=-2.5;break;case 5:l=-3;break;case 6:l=-3.5}var m=Number(document.getElementById("buffer-"+a).value)/50;c.translate(l,.75,
-19);e.merge(c);d.translate(l,.75,-19);g.merge(d);for(var h=l,k=l;k>=l-m;k-=2)c.translate(-2,0,0),e.merge(c),d.translate(-2,0,0),g.merge(d),h-=2;var p=Number(document.getElementById("upstream-"+a).value)/50;k=Math.pow(p,2)+Math.pow(4.5,2);k=Math.floor(Math.sqrt(k))/2;m=p/k;k=4.5/k;var n=0;c.translate(-2,0,0);e.merge(c);d.translate(-2,0,0);g.merge(d);h-=2;p=h-p;for(var q=h;q>p;q-=m)c.translate(-m,0,k),e.merge(c),d.translate(-m,0,k),g.merge(d),n+=k,h-=m;signSpace(f,a);switch(a){case 1:l=10;break;case 2:l=
10.5;break;case 3:l=11;break;case 4:l=11.5;break;case 5:l=12;break;case 6:l=12.5}c.translate(Math.abs(h)+l,0,-n);e.merge(c);d.translate(Math.abs(h)+l,0,-n);g.merge(d);h=l;if((m=Number(document.getElementById("downbuff-"+a).value)/50)&&0<m)for(k=l;k<=l+m;k+=2)c.translate(2,0,0),e.merge(c),d.translate(2,0,0),g.merge(d),h+=2;l=Number(document.getElementById("downstream-"+a).value)/50;c.translate(2,0,0);e.merge(c);d.translate(2,0,0);g.merge(d);h+=2;k=Math.pow(l,2)+Math.pow(4.5,2);k=Math.floor(Math.sqrt(k))/
2;m=l/k;k=4.5/k;n=0;for(p=h+l;h<p;h+=m)c.translate(m,0,k),e.merge(c),d.translate(m,0,k),g.merge(d),n+=k;c=new THREE.Mesh(e,f);b.merge(e);e=new THREE.Mesh(g,white);c.add(e);b.merge(g);b=new THREE.Mesh(b,shadows);c.add(b);c.castShadow=!0;c.name=a+"-cones";scene.add(c);slide("group-"+a);flagger(a,f);arrowSign(f,a);endSign(f,a);render()};function signArray(a,f){var b=signs[a].indexOf(f.value);-1!==b&&signs[a].splice(b,1);f.checked&&signs[a].unshift(f.value)}
function signText(a,f,b){if(0<b.length){var c=document.getElementById("sign-"+a).value;(new THREE.FontLoader).load("fonts/helvetiker_regular.typeface.json",function(b){b=new THREE.TextGeometry(c,{font:b,size:2,height:.2,curveSegments:12,bevelEnabled:!1});b.rotateX(-1.6);b=new THREE.Mesh(b,white);b.position.set(f+4,.5,-9+4*a);b.name="spacing-"+a;scene.add(b);render()})}}
function signSpace(a,f){var b=new THREE.Geometry,c=new THREE.Group,d=[a,workerSignMaterial,flaggerSignMaterial,leftSignMaterial,rightSignMaterial,prepareStopSignMaterial,oneLaneSignMaterial,machineAheadSignMaterial,workAheadSignMaterial,constSignMaterial,utilitySignMaterial,rLaneSignMaterial,menWorkSignMaterial,lLaneMaterial,fMenSignMaterial,flagAheadSignMaterial,closedSignMaterial,shadows],e=signs[f],g=new THREE.CylinderGeometry(2.8,2.8,.1,4),l=new THREE.CylinderGeometry(3.2,3.2,.1,4),m=12.5;0!==
Math.abs(f%2)&&(m-=3);var h=4*f;g.rotateY(1.6);g.translate(m,.5,-10+h);l.rotateY(1.6);l.translate(m,.48,-10+h);signText(f,m,e);for(m=0;m<e.length;m++){switch(e[m]){case "worker":h=1;break;case "flagger":h=2;break;case "left":h=3;break;case "right":h=4;break;case "stop":h=5;break;case "lane":h=6;break;case "machine":h=7;break;case "road":h=8;break;case "const":h=9;break;case "utility":h=10;break;case "rLane":h=11;break;case "men":h=12;break;case "lLane":h=13;break;case "flag":h=14;break;case "fAhead":h=
15;break;case "laneAhead":h=16;break;default:h=6}h=new THREE.Mesh(g,d[h]);c.add(h);b.merge(l);g.translate(-6.5,0,0);l.translate(-6.5,0,0)}a=new THREE.Mesh(b,a);c.add(a);c.castShadow=!0;c.name="signGroup-"+f;scene.add(c)}
for(var $jscomp$loop$4={i:1};6>=$jscomp$loop$4.i;$jscomp$loop$4={i:$jscomp$loop$4.i},$jscomp$loop$4.i++){switch($jscomp$loop$4.i){case 6:document.getElementById("place-"+$jscomp$loop$4.i).addEventListener("click",function(a){return function(){renderCones(a.i,yellow)}}($jscomp$loop$4));break;case 5:document.getElementById("place-"+$jscomp$loop$4.i).addEventListener("click",function(a){return function(){renderCones(a.i,orange)}}($jscomp$loop$4));break;case 4:document.getElementById("place-"+$jscomp$loop$4.i).addEventListener("click",
function(a){return function(){renderCones(a.i,green)}}($jscomp$loop$4));break;case 3:document.getElementById("place-"+$jscomp$loop$4.i).addEventListener("click",function(a){return function(){renderCones(a.i,blue)}}($jscomp$loop$4));break;case 2:document.getElementById("place-"+$jscomp$loop$4.i).addEventListener("click",function(a){return function(){renderCones(a.i,purple)}}($jscomp$loop$4));break;default:document.getElementById("place-"+$jscomp$loop$4.i).addEventListener("click",function(a){return function(){renderCones(a.i,
red)}}($jscomp$loop$4))}document.getElementById("button-group-"+$jscomp$loop$4.i).addEventListener("click",function(a){return function(){slide("group-"+a.i)}}($jscomp$loop$4));document.getElementById("clear-"+$jscomp$loop$4.i).addEventListener("click",function(a){return function(){clearCones(a.i,!0)}}($jscomp$loop$4));document.getElementById("option-"+$jscomp$loop$4.i+"-arrowArray").addEventListener("change",function(a){return function(){arrowArray(a.i,document.getElementById("option-"+a.i+"-arrowArray"))}}($jscomp$loop$4));
document.getElementById("option-"+$jscomp$loop$4.i+"-endArray").addEventListener("change",function(a){return function(){endArray(a.i,document.getElementById("option-"+a.i+"-endArray"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-worker").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-worker"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-flagger").addEventListener("change",function(a){return function(){signArray(a.i,
document.getElementById("sign-"+a.i+"-flagger"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-left").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-left"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-right").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-right"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+
"-stop").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-stop"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-lane").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-lane"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-machine").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+
"-machine"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-road").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-road"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-const").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-const"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-utility").addEventListener("change",
function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-utility"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-rLane").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-rLane"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-men").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-men"))}}($jscomp$loop$4));document.getElementById("sign-"+
$jscomp$loop$4.i+"-lLane").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-lLane"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-flag").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-flag"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-fAhead").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+
a.i+"-fAhead"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i+"-laneAhead").addEventListener("change",function(a){return function(){signArray(a.i,document.getElementById("sign-"+a.i+"-laneAhead"))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i).addEventListener("focus",function(a){return function(){focusChange(document.getElementById("sign-"+a.i))}}($jscomp$loop$4));document.getElementById("sign-"+$jscomp$loop$4.i).addEventListener("blur",function(a){return function(){focusStop(document.getElementById("sign-"+
a.i))}}($jscomp$loop$4));document.getElementById("upstream-"+$jscomp$loop$4.i).addEventListener("focus",function(a){return function(){focusChange(document.getElementById("upstream-"+a.i))}}($jscomp$loop$4));document.getElementById("upstream-"+$jscomp$loop$4.i).addEventListener("blur",function(a){return function(){focusStop(document.getElementById("upstream-"+a.i))}}($jscomp$loop$4));document.getElementById("buffer-"+$jscomp$loop$4.i).addEventListener("focus",function(a){return function(){focusChange(document.getElementById("buffer-"+
a.i))}}($jscomp$loop$4));document.getElementById("buffer-"+$jscomp$loop$4.i).addEventListener("blur",function(a){return function(){focusStop(document.getElementById("buffer-"+a.i))}}($jscomp$loop$4));document.getElementById("downbuff-"+$jscomp$loop$4.i).addEventListener("focus",function(a){return function(){focusChange(document.getElementById("downbuff-"+a.i))}}($jscomp$loop$4));document.getElementById("downbuff-"+$jscomp$loop$4.i).addEventListener("blur",function(a){return function(){focusStop(document.getElementById("downbuff-"+
a.i))}}($jscomp$loop$4));document.getElementById("downstream-"+$jscomp$loop$4.i).addEventListener("focus",function(a){return function(){focusChange(document.getElementById("downstream-"+a.i))}}($jscomp$loop$4));document.getElementById("downstream-"+$jscomp$loop$4.i).addEventListener("blur",function(a){return function(){focusStop(document.getElementById("downstream-"+a.i))}}($jscomp$loop$4))};
